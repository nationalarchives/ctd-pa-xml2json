# ctd-pa-xml2json
Repository for code created as part of the Parliamentary Archives transfer to The National Archives

## There are four main stylesheets:

**removeEmptyTags** - This stylesheet can be run in the Calm XML to remove empty tags. This drastically reduces the length of the XML file and makes it easier to work with. 

It is recommended to set the output file to be a copy so that you always have the original to fall back on if there is a problem.
    
    Example Oxygen Transformation Scenario setup:
        Input:
            XML URL: ${currentFileURL}
            XSL URL: [path to stylesheet]
        Output:
            Save as: ${cfn}_trimmed.xml

**createBlankLookup** - This stylesheet creates an xml file with the format below with a record being created for every DScribeRecord found in the processed text.

    <xml>
    
        <record refno="[reference value]" IAID="[generated identifier]" parentIAID="" />
        
        ...
        
    </xml>

The current version of the code uses the inbuild generate-id() function to create a unique identifier. This is a placeholder fumction until the format and generation process for the IAID is finalised. 

    Example Oxygen Transformation Scenario setup:
        Input:
            XML URL: [path to Calm XML]
            XSL URL: ${currentFileURL}
        Output:
            Save as: ${pd}/[path to output folder]/IAID-Lookup.xml

**populateParentIAID** - This stylesheet is run on IAID-Lookup.xml and populates the parentIAID attribute from the IAID attribute value in the record identified as the parent. 

The parent record is identified as the record with the refno that matches the refno of the current record with the text after the last slash e.g. AA/BB/CC (current)-> AA/BB (parent)

    Example Oxygen Transformation Scenario setup:
        Input:
            XML URL: ${pdu}/[path to output folder]/IAID-Lookup.xml
            XSL URL: ${currentFileURL}
        Output:
            Save as: ${pd}/[path to output folder]/IAID-Lookup.xml

**Disco_JSON** - This spreadsheet reads from a given CALM XML file and the IAID-Lookup.xml file and generates a JSON file using the fields expected by the Discovery upload process. 

Notes:

* A transfer-id is generated by the inbuild generate-id() function to create a unique identifier. This is a placeholder fumction until the format and generation process for the transfer ID is finalised as this value is required by the Discovery process. 

* The text contains \\\\, \\n, multiple spaces or '&quot;' it is escaped to create valid JSON and tidy up extra spaces:

| Input | Output |
|-------|--------|
| \\\\    | \\\\\\\\   |
| &\#10;   | \[space\] |
| &quot; | \\\\&quot; |
| \[double space\] | \[single space\] |

## Helper stylesheets:

**Prototypes/getValues** - This stylesheet was created as an easy way to extract all the values of a certain field (specified in the stylesheet) for review or analysis

## Other Stylesheets:

**Disco_XML** - This stylesheet was created to convert the CALM XML into BIA XML. This transformation was superceeded by the XML -> JSON process.

**Prototypes/XML2JSON** - used to test inbuilt xml-to-json() function

**Prototypes/Disco_XML2** - used to test xml-to-json() with Disco_XML transformation

**Prototypes/Disco_JSON3** - used to test output of description
